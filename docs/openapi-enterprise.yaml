openapi: 3.1.0
info:
  title: Mend Renovate Self-Hosted Enterprise Edition
  description: |
    APIs associated with [Mend Renovate Self-Hosted Enterprise Edition](https://github.com/mend/renovate-ce-ee/).

    This API documentation is a superset of the Community Edition and Enterprise Edition and includes all APIs and API data that is available when using the Enterprise Edition. See the separate OpenAPI specification for APIs and API data only available in Mend Renovate Community Edition.
  version: 1.0.0
tags:
  - name: API
    description: |
      Public API endpoints

      These APIs are only available when setting the `env MEND_RNV_API_ENABLED=true` (renamed from `MEND_RNV_ADMIN_API_ENABLED`) environment variable when starting CE/EE.
  - name: System
    description: |
      System/admin endpoints

      In addition to setting `env MEND_RNV_API_ENABLED=true`, you also need to set the `env MEND_RNV_API_ENABLE_SYSTEM=true` environment variable when starting CE/EE.
  - name: Reporting
    description: |
      Reporting APIs provide real-time data about the state of Orgs, Repos, and Pull requests that are managed by Mend Renovate Self-Hosted.

      In addition to setting `env MEND_RNV_API_ENABLED=true`, you also need to set the `env MEND_RNV_API_ENABLE_REPORTING=true` environment variable when starting CE/EE.

      When using the Reporting APIs, a few other environment variables are required:

      - On the Workers:
        - `RENOVATE_REPOSITORY_CACHE=enabled`
        - If using the S3 repo cache, `RENOVATE_X_REPO_CACHE_FORCE_LOCAL=true` must be set
      - On the Server:
        - `MEND_RNV_CRON_LIBYEARS_MV_REFRESH` can be specified to override the cron schedule for updating org-level LibYears stats. The default is `20 * * * *` (every hour at 20 minutes past the hour)
  - name: Jobs
    description: |
      Job Logs APIs provide a summary of and content for the Job Logs generated by the Mend Renovate CLI.

      In addition to setting `env MEND_RNV_API_ENABLED=true`, you also need to set the `env MEND_RNV_API_ENABLE_JOBS=true` environment variable when starting CE/EE.
  - name: Enterprise-Only
    description: |
      APIs associated with [Mend Renovate Self-Hosted Enterprise Edition](https://github.com/mend/renovate-ce-ee/).

      These APIs are a superset of the Community Edition and Enterprise Edition - see the separate OpenAPI specification for APIs only available in Mend Renovate Self-Hosted Community Edition.
  - name: GitHub-Only
    description: |
      Features that are currently only supported when using the GitHub platform, when running in `env MEND_RNV_PLATFORM=github`.
paths:
  /metrics:
    get:
      operationId: getPrometheusMetrics
      summary: Fetch Prometheus metrics for the instance (if configured)
      description: |
        Return Prometheus metrics for the Mend Renovate Self-Hosted deployment.

        Controlled by `MEND_RNV_API_ENABLE_PROMETHEUS_METRICS` (backward compatible with `MEND_RNV_PROMETHEUS_METRICS_ENABLED`)

        There are default metrics are exposed by Node.JS for the Mend Renovate Self-Hosted Server responding to the API request, _not_ the worker(s)

        There are also [several custom metrics produced by Mend Renovate Self-Hosted](https://github.com/mend/renovate-ce-ee/blob/HEAD/docs/prometheus-metrics.md).
      security: []
      responses:
        '200':
          description: 'Metrics exposed can be found documented at https://github.com/mend/renovate-ce-ee/blob/HEAD/docs/prometheus-metrics.md'
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Prometheus metrics were not enabled
          content:
            text/html:
              schema:
                type: string
  /system/v1/sync:
    post:
      operationId: requestAppSync
      tags:
        - System
      summary: Enqueue a background app sync task and return immediately
      description: |
        Triggers an immediate repository sync against the platform/server.
        Normally you don't need this endpoint.
        But it can be useful if you think Mend Renovate Self-Hosted's internal state has become out of sync: for example when a new repository is missing.
      security:
        - serverApiSecret: []
      responses:
        '200':
          description: Task enqueued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
              examples:
                success:
                  value:
                    message: sync task successfully enqueued
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /system/v1/jobs/purge:
    post:
      operationId: purgeFailedJobs
      tags:
        - System
      summary: Request a background purge failed jobs task
      description: Enqueue a background purge failed jobs task and return immediately.
      security:
        - serverApiSecret: []
      responses:
        '200':
          description: Purge task enqueued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
              examples:
                success:
                  value:
                    message: purge failed jobs task successfully enqueued
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /system/v1/jobs/add:
    post:
      operationId: enqueueRepoJob
      tags:
        - System
      summary: Add a job by repository
      description: Enqueue a job for the given repository.
      security:
        - serverApiSecret: []
      requestBody:
        description: The request body specifies the repository to add a job for.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddJobRequest'
      responses:
        '200':
          description: Job already queued or updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnqueueJobResponse'
              examples:
                updated:
                  value:
                    message: Existing job updated and is pending.
                    jobId: fd6e1e01-9b8c-4cf2-826e-7cd91e33c2eb
                    status: pending
                    change: updated
                unchanged:
                  value:
                    message: Job already pending.
                    jobId: fd6e1e01-9b8c-4cf2-826e-7cd91e33c2eb
                    status: pending
                    change: unchanged
        '201':
          description: Job queued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnqueueJobResponse'
              examples:
                queued:
                  value:
                    message: Job added to queue and is pending.
                    jobId: fd6e1e01-9b8c-4cf2-826e-7cd91e33c2eb
                    status: pending
                    change: inserted
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingField:
                  value:
                    reason: Bad Request
                    message: 'Request body is missing a required field: repository'
                    url: 'https://renovate.example.com/system/v1/jobs/add'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                RepositoryNotFound:
                  value:
                    reason: Not Found
                    message: installation does not include the given repository
                    url: 'https://renovate.example.com/system/v1/jobs/add'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /system/v1/status:
    get:
      operationId: getStatus
      tags:
        - System
      summary: Get system status
      description: |
        Return the current status of the service since boot time. This information includes job history, job queue size, in-progress jobs, scheduler status, webhook status, Mend Renovate CLI version, and more.

        If you interact with a non-primary Mend Renovate Self-Hosted Server, some fields may not be returned.

        All timestamps in the response body are in UTC.
      security:
        - serverApiSecret: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Status'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /system/v1/tasks/queue:
    get:
      operationId: getTaskQueue
      tags:
        - System
      summary: 'Returns the current status of the job queue, including number of pending jobs'
      description: |
        Returns the current status of the task queue, including number of pending tasks.
        Generally speaking, tasks are internal implementation details, such as syncing.
        As end-user you usually do not need to worry about tasks.
        This API is exposed primarily to help you troubleshoot if something is going wrong.
      security:
        - serverApiSecret: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                maxItems: 100
                items:
                  $ref: '#/components/schemas/Task'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /system/v1/jobs/queue:
    get:
      operationId: getJobQueue
      tags:
        - System
      summary: Get job queue
      description: Return up to 100 jobs from the queue.
      security:
        - serverApiSecret: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobQueue'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  '/system/v1/jobs/logs/{jobId}':
    get:
      operationId: downloadJobLogs
      tags:
        - System
        - Jobs
      summary: Get job logs
      description: |
        Returns plain text logs for the given job ID.

        Note that this does not require an `orgRepo` parameter to be specified, unlike `downloadJobLogsPublic`.
      security:
        - serverApiSecret: []
      parameters:
        - $ref: '#/components/parameters/JobId'
      responses:
        '200':
          $ref: '#/components/responses/JSONLinesResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingPathParam:
                  value:
                    reason: Bad Request
                    message: No jobId specified in the path
                    url: 'https://renovate.example.com/system/v1/jobs/logs/b65e3574-9c0c-4b69-b6d1-df00b1d325e0'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/LogsNotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  '/api/v1/repos/{orgRepo}/-/jobs/run':
    post:
      operationId: enqueueRepoJobPublic
      tags:
        - API
        - Jobs
      summary: Add a job by repository via path params
      description: Enqueue a job for the given repository via path params.
      security:
        - serverApiSecret: []
        - githubRoleBasedAccessControl:
            - 'repo:write'
            - 'org:write'
        - bitbucketRoleBasedAccessControl:
            - 'repo:write'
            - 'org:write'
      parameters:
        - $ref: '#/components/parameters/OrgRepo'
      requestBody:
        description: 'No request body is required, as the `orgRepo` parameter is used instead.'
        required: false
        content: {}
      responses:
        '200':
          description: Job already queued or updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnqueueJobResponse'
              examples:
                updated:
                  value:
                    message: Existing job updated and is pending.
                    jobId: fd6e1e01-9b8c-4cf2-826e-7cd91e33c2eb
                    status: pending
                    change: updated
                unchanged:
                  value:
                    message: Job already pending.
                    jobId: fd6e1e01-9b8c-4cf2-826e-7cd91e33c2eb
                    status: pending
                    change: unchanged
        '201':
          description: Job queued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnqueueJobResponse'
              examples:
                queued:
                  value:
                    message: Job added to queue and is pending.
                    jobId: fd6e1e01-9b8c-4cf2-826e-7cd91e33c2eb
                    status: pending
                    change: inserted
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingField:
                  value:
                    reason: Bad Request
                    message: No repository specified in the path
                    url: 'https://renovate.example.com/api/v1/repos/example.com/not-a-repo/-/jobs/run'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                RepositoryNotFound:
                  value:
                    reason: Not Found
                    message: installation does not include the given repository
                    url: 'https://renovate.example.com/api/v1/repos/example.com/not-a-repo/-/jobs/run'
        '500':
          $ref: '#/components/responses/InternalServerError'
  '/api/v1/repos/{orgRepo}/-/jobs/{jobId}':
    get:
      operationId: downloadJobLogsPublic
      tags:
        - API
        - Jobs
      summary: Get a repository job logs
      description: Get plain text logs for the given job ID for the given repository.
      security:
        - serverApiSecret: []
        - githubRoleBasedAccessControl:
            - 'repo:read'
            - 'org:write'
        - bitbucketRoleBasedAccessControl:
            - 'repo:read'
            - 'org:write'
      parameters:
        - $ref: '#/components/parameters/OrgRepo'
        - $ref: '#/components/parameters/JobId'
      responses:
        '200':
          $ref: '#/components/responses/JSONLinesResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingPathParam:
                  value:
                    reason: Bad Request
                    message: Missing jobId or orgRepo path params
                    url: 'https://renovate.example.com/api/v1/repos/example.com/not-a-repo/-/jobs/e08eae1d-86a4-429a-b5b7-6967b043e47b'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/LogsNotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  '/api/v1/repos/{orgRepo}/-/jobs':
    get:
      operationId: getRepoJobs
      tags:
        - API
        - Jobs
      summary: Get jobs report for repo
      description: |
        Returns a paginated list of jobs for the given repository, ordered by newest first.

        Pagination:
        - Use the `limit` query parameter to control page size.
        - If more results are available, the response includes an RFC 8288 `Link` header with a `rel="next"` URL.
        - To fetch the next page, perform a GET request to the URL in `Link: <...>; rel="next"`.
      security:
        - serverApiSecret: []
        - githubRoleBasedAccessControl:
            - 'repo:read'
            - 'org:write'
        - bitbucketRoleBasedAccessControl:
            - 'repo:read'
            - 'org:write'
      parameters:
        - $ref: '#/components/parameters/OrgRepo'
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 10000
          description: 'If the value provided is higher than the maximum, the maximum will be used.'
        - $ref: '#/components/parameters/RepoJobsCursor'
      responses:
        '200':
          description: OK
          headers:
            Link:
              $ref: '#/components/headers/PaginationLink'
            x-next-cursor:
              $ref: '#/components/headers/x-next-cursor'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/JobReport'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidLimitQueryParam:
                  value:
                    reason: Bad Request
                    message: Invalid limit
                    url: 'https://renovate.example.com/api/v1/repos/example.com/not-a-repo/-/jobs'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /api/v1/orgs/-/libyears:
    get:
      operationId: systemLibYears
      tags:
        - Reporting
        - Enterprise-Only
      summary: Get aggregated system-wide LibYears report
      description: |
        Get an aggregated system-wide LibYears report for organizations based on their state.
      security:
        - serverApiSecret: []
        - githubRoleBasedAccessControl:
            - 'org:write'
        - bitbucketRoleBasedAccessControl:
            - 'org:write'
      parameters:
        - $ref: '#/components/parameters/InstalledOrgState'
        - $ref: '#/components/parameters/LibYearsDetails'
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 100
            minimum: 1
            maximum: 10000
          description: 'If the value provided is higher than the maximum, the maximum will be used.'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LibYearsWithContext'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  '/api/v1/orgs/{org}/-/libyears':
    get:
      operationId: orgLibYears
      tags:
        - Reporting
        - Enterprise-Only
      summary: Get aggregated org wide LibYears report
      description: |
        Get an aggregated org wide LibYears report.
        Setting the "details" query parameter will return individual repository data,
        sorted in descending order based on their total LibYears score.
      security:
        - serverApiSecret: []
        - githubRoleBasedAccessControl:
            - 'org:write'
        - bitbucketRoleBasedAccessControl:
            - 'org:write'
      parameters:
        - $ref: '#/components/parameters/Org'
        - $ref: '#/components/parameters/LibYearsDetails'
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 100
            minimum: 1
            maximum: 10000
          description: 'If the value provided is higher than the maximum, the maximum will be used.'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LibYearsWithContext'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  '/api/v1/repos/{orgRepo}/-/libyears':
    get:
      operationId: repoLibYears
      tags:
        - Reporting
        - Enterprise-Only
      summary: Get aggregated repo wide LibYears report
      security:
        - serverApiSecret: []
        - githubRoleBasedAccessControl:
            - 'repo:read'
            - 'org:write'
        - bitbucketRoleBasedAccessControl:
            - 'repo:read'
            - 'org:write'
      parameters:
        - $ref: '#/components/parameters/OrgRepo'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LibYearsWithContext'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /api/v1/orgs:
    get:
      operationId: getOrgs
      tags:
        - Reporting
      summary: Get organizations metadata
      description: |
        Returns a paginated list of organizations and their metadata.

        Filtering:
        - Use the optional `q` query parameter to filter organizations by name.
        - Matching is case-insensitive.

        Pagination:
        - Use the `limit` query parameter to control page size.
        - If more results are available, the response includes an RFC 8288 `Link` header with a `rel="next"` URL.
        - To fetch the next page, perform a GET request to the URL in `Link: <...>; rel="next"`.
      security:
        - serverApiSecret: []
        - githubRoleBasedAccessControl:
            - 'org:write'
        - bitbucketRoleBasedAccessControl:
            - 'org:write'
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 100
            minimum: 1
            maximum: 10000
          description: 'If the value provided is higher than the maximum, the maximum will be used.'
        - $ref: '#/components/parameters/OrgState'
        - $ref: '#/components/parameters/OrgsQuery'
        - $ref: '#/components/parameters/OrgsCursor'
      responses:
        '200':
          description: OK
          headers:
            Link:
              $ref: '#/components/headers/PaginationLink'
            x-next-cursor:
              $ref: '#/components/headers/x-next-cursor'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrgMeta'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  '/api/v1/orgs/{org}/-/repos':
    get:
      operationId: getOrgRepos
      tags:
        - Reporting
      summary: Get organization repositories info
      description: |
        Returns a paginated list of repositories for the given organization.

        Filtering:
        - Use the `state` query parameter to filter repositories by installation state.
          The default state is `installed`.
        - Use the optional `q` query parameter to filter repositories by name or full name.
          (the organization prefix is omitted, e.g. `repo1` not `org1/repo1`).
        - Matching for the `q` parameter is case-insensitive.

        Pagination:
        - Use the `limit` query parameter to control page size.
        - If more results are available, the response includes an RFC 8288 `Link` header
          with a `rel="next"` URL.
        - To fetch the next page, perform a GET request to the URL in
          `Link: <...>; rel="next"`.
      security:
        - serverApiSecret: []
        - githubRoleBasedAccessControl:
            - 'repo:read'
            - 'org:write'
        - bitbucketRoleBasedAccessControl:
            - 'repo:read'
            - 'org:write'
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 100
            minimum: 1
            maximum: 10000
          description: 'If the value provided is higher than the maximum, the maximum will be used.'
        - $ref: '#/components/parameters/Org'
        - $ref: '#/components/parameters/OrgReposState'
        - $ref: '#/components/parameters/OrgReposQuery'
        - $ref: '#/components/parameters/OrgReposCursor'
      responses:
        '200':
          description: OK
          headers:
            Link:
              $ref: '#/components/headers/PaginationLink'
            x-next-cursor:
              $ref: '#/components/headers/x-next-cursor'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RepositoryInfo'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  '/api/v1/orgs/{org}':
    get:
      operationId: getOrgStats
      tags:
        - Reporting
      summary: Get organizations stats
      security:
        - serverApiSecret: []
        - githubRoleBasedAccessControl:
            - 'org:write'
        - bitbucketRoleBasedAccessControl:
            - 'org:write'
      parameters:
        - $ref: '#/components/parameters/Org'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrgReport'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  '/api/v1/repos/{orgRepo}/-/pulls':
    get:
      operationId: getPullRequests
      tags:
        - Reporting
        - Enterprise-Only
        - GitHub-Only
      summary: Get repository Renovate pull requests
      description: |
        Get repository Renovate pull requests

        **NOTE** that this requires additional configuration in your deployment:

        - `RENOVATE_REPOSITORY_CACHE=enabled` must be set on Workers
        - If using the S3 repo cache, `RENOVATE_X_REPO_CACHE_FORCE_LOCAL=true` must be set on Workers
      security:
        - serverApiSecret: []
        - githubRoleBasedAccessControl:
            - 'repo:read'
            - 'org:write'
        - bitbucketRoleBasedAccessControl:
            - 'repo:read'
            - 'org:write'
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 100
            minimum: 1
            maximum: 10000
          description: 'If the value provided is higher than the maximum, the maximum will be used.'
        - $ref: '#/components/parameters/OrgRepo'
        - $ref: '#/components/parameters/PullRequestStateExtended'
      responses:
        '200':
          description: |
            List all repository pull requests.

            NOTE that an empty array `[]` will be returned for non-existent repositories, instead of an HTTP 404.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PullRequestStats'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  '/api/v1/repos/{orgRepo}':
    get:
      operationId: getRepositoryStats
      tags:
        - Reporting
      summary: Get repository Renovate stats
      security:
        - serverApiSecret: []
        - githubRoleBasedAccessControl:
            - 'repo:read'
            - 'org:write'
        - bitbucketRoleBasedAccessControl:
            - 'repo:read'
            - 'org:write'
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 100
            minimum: 1
            maximum: 10000
          description: 'If the value provided is higher than the maximum, the maximum will be used.'
        - $ref: '#/components/parameters/OrgRepo'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RepositoryStats'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  '/api/v1/repos/{orgRepo}/-/dashboard':
    get:
      operationId: getRepositoryDashboard
      tags:
        - Reporting
        - Enterprise-Only
      summary: Get Renovate repository dashboard
      security:
        - serverApiSecret: []
        - githubRoleBasedAccessControl:
            - 'repo:read'
            - 'org:write'
        - bitbucketRoleBasedAccessControl:
            - 'repo:read'
            - 'org:write'
      parameters:
        - $ref: '#/components/parameters/OrgRepo'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RenovateDashboard'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  securitySchemes:
    serverApiSecret:
      type: http
      scheme: bearer
      bearerFormat: opaque
      description: |
        Admin bearer token required for endpoint.

        This is the static admin token set in the `MEND_RNV_API_SERVER_SECRET` (renamed from `MEND_RNV_SERVER_API_SECRET`) environment variable.
        Supports being sent with and without the `Bearer ` prefix for legacy reasons.

        **Example**:
        When running CE/EE with `env MEND_RNV_API_SERVER_SECRET=renovate-api-secret`, you can authenticate to this endpoint with:
        - Authorization: Bearer renovate-api-secret
        - Authorization: renovate-api-secret
    githubRoleBasedAccessControl:
      type: oauth2
      description: |
        Authenticate to the API using a GitHub Personal Access Token (Fine-Grained or Classic).

        This uses GitHub's inbuilt authorization model to determine what levels of access a user has to a repository, and the actions they are permitted.

        When multiple scopes are required, such as `repo:write` and `org:write`, the presence of either scope is sufficient.

        This authentication method is only available when setting the `env MEND_RNV_SERVER_RBAC_ENABLED=true` environment variable when starting CE/EE.

        See [the Mend Renovate Self-Hosted RBAC docs](https://github.com/mend/renovate-ce-ee/blob/HEAD/docs/rbac.md) for more information on how to create a Personal Access Token (Fine-Grained or Classic) that has the relevant access.
      flows:
        password:
          tokenUrl: 'https://unused.example.com'
          scopes:
            none: |
              User has no access to the repository or organization.

              This scope is not used in practice, but is added for completeness.
            'repo:read': |
              User has read access to the repository (or all repositories in the request)

              This is calculated through one of the following cases:

              - Direct read access (as a team or collaborator)
              - The repository is Public
              - The repository is Internal (and the user is part of the Enterprise that owns the repository)
            'repo:write': |
              User has write access to the repository (or all repositories in the request)

              This is calculated through one of the following cases:

              - Direct `Write`, `Triage` or `Admin` role access (as a team or collaborator)
              - The user is an Organisation Owner
            'org:read': |
              User has read access to the organization (or all organizations in the request)

              This is calculated through one of the following cases:

              - The user is a `Member` of an organization
              - The user is an `Owner` of an organization
              - The user is a `Billing Manager` of an organization
            'org:write': |
              User has write access to the organization (or all organizations in the request)

              This is true if the user is an Organisation Owner.
    bitbucketRoleBasedAccessControl:
      type: oauth2
      description: |
        Authenticate to the API using a Bitbucket HTTP Token.

        This uses the permissions on the Bitbucket Data Center HTTP Token to determine what levels of access a user has to a repository, and the actions they are permitted.

        When multiple scopes are required, such as `repo:write` and `org:write`, the presence of either scope is sufficient.

        When multiple repositories are being queried, Bitbucket Data Center's security model will return the lowest permissions for all repositories in the request. For example, if the token has 5x `REPO_WRITE` and 1x `REPO_READ`, the access will be `repo:read`

        This authentication method is only available when setting the `env MEND_RNV_SERVER_RBAC_ENABLED=true` environment variable when starting CE/EE.

        See [the Mend Renovate Self-Hosted RBAC docs](https://github.com/mend/renovate-ce-ee/blob/HEAD/docs/rbac.md) for more information.

        Note that this permissions data is, by default, cached for 60m after first authorization.
      flows:
        password:
          tokenUrl: 'https://unused.example.com'
          scopes:
            none: |
              Token has no access to the repository

              This scope is not used in practice, but is added for completeness
            'repo:read': |
              Token has read access to the repository (or all repositories in the request)

              This is calculated through the token having the `REPO_READ`, `REPO_WRITE` or `REPO_ADMIN` permission.
            'repo:write': |
              User has write access to the repository (or all repositories in the request)

              This is calculated through the token having the `REPO_WRITE` or `REPO_ADMIN` permission.
            'org:read': |
              User has read access to the organization (or all organizations in the request)

              This is calculated through the token having the `PROJECT_READ`, `PROJECT_WRITE` or `PROJECT_ADMIN` permission.
            'org:write': |
              User has write access to the organization (or all organizations in the request)

              This is calculated through the token having the `PROJECT_WRITE` or `PROJECT_ADMIN` permission.
  parameters:
    JobId:
      name: jobId
      in: path
      required: true
      schema:
        oneOf:
          - $ref: '#/components/schemas/JobId'
          - type: string
            description: Automagically determine the most recently completed job's ID
            enum:
              - latest
    Org:
      name: org
      in: path
      required: true
      schema:
        type: string
    OrgsCursor:
      name: cursor
      in: query
      required: false
      schema:
        type: string
      description: |
        Org list pagination cursor

        The cursor is an opaque pagination token, and clients should not attempt to interpret it.

        Prefer using the `rel="next"` URL from the `Link` header when iterating pages.

        If the cursor is invalid, the request will be rejected with an HTTP 400 Bad Request.
      x-no-backwards-compatibility-guarantees: true
    OrgsQuery:
      name: q
      in: query
      required: false
      schema:
        type: string
      description: Organization name query filter.
    OrgRepo:
      name: orgRepo
      description: |
        OrgRepo defines a combination of organisation and repository, or organisations and repository.

        NOTE that although not technically OpenAPI compliant, the `orgRepo` path parameter takes an organisation + repo(s) slug, which is not URL encoded.

        For instance:

        - `https://gitlab.example.com/infrastructure/renovate/runner` would have `orgRepo=infrastructure/renovate/runner`
        - `https://github.example.com/renovatebot/renovate` would have `orgRepo=renovatebot/renovate`
      in: path
      required: true
      schema:
        type: string
    OrgReposCursor:
      name: cursor
      in: query
      required: false
      schema:
        type: string
      description: |
        Organizations repository pagination cursor.

        The cursor is an opaque pagination token, and clients should not attempt to interpret it.

        Prefer using the `rel="next"` URL from the `Link` header when iterating pages.

        If the cursor is invalid, the request will be rejected with an HTTP 400 Bad Request.
      x-no-backwards-compatibility-guarantees: true
    OrgReposQuery:
      name: q
      in: query
      required: false
      schema:
        type: string
        description: Repository name query filter.
    RepoJobsCursor:
      name: cursor
      in: query
      required: false
      schema:
        type: string
      description: |
        Repository jobs pagination cursor.

        The cursor is an opaque pagination token, and clients should not attempt to interpret it.

        Prefer using the `rel="next"` URL from the `Link` header when iterating pages.

        If the cursor is invalid, the request will be rejected with an HTTP 400 Bad Request.
      x-no-backwards-compatibility-guarantees: true
    OrgState:
      name: state
      in: query
      required: false
      schema:
        type: string
        description: |
          What state organizations are in, based on the installation status:

          - `active`: any installations that are `enabled` and NOT `suspended`
          - `suspended`: any installations that are `enabled` and `suspended`
          - `installed`: any installations that are `enabled` or `suspended`
          - `uninstalled`: any installations that are NOT `enabled`
          - `all`: any installation state
        enum:
          - installed
          - active
          - suspended
          - uninstalled
          - all
    InstalledOrgState:
      name: state
      in: query
      required: false
      schema:
        type: string
        default: installed
        enum:
          - installed
          - active
          - suspended
    OrgReposState:
      name: state
      in: query
      required: false
      schema:
        type: string
        enum:
          - installed
          - uninstalled
          - all
    LibYearsDetails:
      name: details
      description: |
        Display details of child entities, if appropriate

        For instance, when using the System LibYears API, this will also return a per-organization breakdown of LibYears calculations.

        When using the Organizations LibYears API, this will also return a per-repo breakdown of LibYears calculations.
      in: query
      required: false
      schema:
        type: boolean
    PullRequestStateExtended:
      name: state
      in: query
      schema:
        allOf:
          - $ref: '#/components/schemas/PullRequestState'
          - type: string
            enum:
              - all
    Sha:
      name: sha
      in: path
      required: true
      schema:
        type: string
  headers:
    PaginationLink:
      description: |
        An RFC 8288 web linking header

        Only `rel=next` is supported.

        When present, contains a `rel="next"` URL to fetch the next page of results.

        The URL in `rel="next"` will be relative.
      schema:
        type: string
    x-next-cursor:
      description: |
        The value of `cursor` to retrieve the next page of results, if any

        When present, contains the value for `cursor` that can be used to retrieve the next page of results.

        The cursor is an opaque pagination token, and clients should not attempt to interpret it.
      schema:
        type: string
  responses:
    PlainOK:
      description: Plain OK response
      content:
        text/plain:
          schema:
            type: string
    JSONLinesResponse:
      description: |
        A response of data in the JSON Lines format.

        JSON lines is also known as "newline-delimited" JSON, and has JSON objects which are delimited by the `\n` character.

        The `text/plain` media type is used until a Media Type is reserved for the usage.
      content:
        text/plain:
          schema:
            description: |
              JSON Lines formatted data, with JSON objects which are delimited by the `\n` character.
            type: string
    BadRequest:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NoContent:
      description: No Content
    UnauthorizedError:
      description: Unauthorized
    ForbiddenError:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
        text/plain:
          schema:
            type: string
    InternalServerError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFoundError:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    LogsNotFoundError:
      description: Logs Not Found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/LogsNotFound'
  schemas:
    AddJobRequest:
      type: object
      required:
        - repository
      properties:
        repository:
          type: string
          description: |
            The organisation + repo(s) slug

            For instance:

            - `https://gitlab.example.com/infrastructure/renovate/runner` would have `orgRepo=infrastructure/renovate/runner`
            - `https://github.example.com/renovatebot/renovate` would have `orgRepo=renovatebot/renovate`
    MessageResponse:
      type: object
      properties:
        message:
          type: string
      required:
        - message
    ActiveJobStatus:
      type: string
      enum:
        - pending
        - running
    EnqueueJobResponse:
      type: object
      properties:
        message:
          type: string
        jobId:
          $ref: '#/components/schemas/JobId'
        status:
          $ref: '#/components/schemas/ActiveJobStatus'
        change:
          type: string
          enum:
            - inserted
            - updated
            - unchanged
      required:
        - message
        - jobId
        - status
        - change
    ErrorResponse:
      type: object
      properties:
        reason:
          type: string
        message:
          type: string
        url:
          description: The URL that the error occurred on
          type: string
      required:
        - reason
        - message
        - url
    CronMeta:
      type: object
      properties:
        cron:
          type: string
          description: Cron expression (optional)
        lastScheduling:
          $ref: '#/components/schemas/DateFormat'
          description: timestamp of the last scheduling
      required:
        - lastScheduling
    Scheduler:
      type: object
      properties:
        allJobs:
          $ref: '#/components/schemas/CronMeta'
        hotJobs:
          $ref: '#/components/schemas/CronMeta'
        coldJobs:
          $ref: '#/components/schemas/CronMeta'
        cappedJobs:
          $ref: '#/components/schemas/CronMeta'
        sync:
          $ref: '#/components/schemas/CronMeta'
      required:
        - allJobs
        - sync
    JobReason:
      type: string
      enum:
        - automerge
        - manual-pr-merge
        - rebase-request
        - dependency-dashboard
        - onboarding-update
        - main-commit
        - renovate-config-commit
        - pr-update
        - manual-pr-close
        - closed-pr-rename
        - hourly
        - schedule-all
        - schedule-capped
        - schedule-cold
        - schedule-hot
        - installed
        - unsuspend
        - repositories-added
        - repositories-added-sync
        - api-request
        - web-ui
    JobInfo:
      type: object
      properties:
        repository:
          type: string
        priority:
          type: integer
        reason:
          $ref: '#/components/schemas/JobReason'
      required:
        - repository
        - priority
        - reason
    RepositorySelection:
      type: string
      enum:
        - all
        - selected
    OrganizationBase:
      type: object
      properties:
        organizationName:
          type: string
        installationId:
          type: integer
        suspended:
          type: boolean
          description: |
            When `env MEND_RNV_PLATFORM=github`: Whether the Renovate GitHub app has been suspended on the organization/repository.

            When `env MEND_RNV_PLATFORM=gitlab`: This is unused, and always returns `false`.

            When `env MEND_RNV_PLATFORM=bitbucket-server`: This is unused, and always returns `false`.
        repositorySelection:
          $ref: '#/components/schemas/RepositorySelection'
    Organization:
      allOf:
        - $ref: '#/components/schemas/OrganizationBase'
        - type: object
          properties:
            organizationName:
              type: string
          required:
            - organizationName
    OrganizationOptional:
      $ref: '#/components/schemas/OrganizationBase'
    Job:
      allOf:
        - $ref: '#/components/schemas/JobInfo'
        - $ref: '#/components/schemas/Organization'
        - type: object
          properties:
            jobId:
              $ref: '#/components/schemas/JobId'
            addedAt:
              $ref: '#/components/schemas/DateFormat'
            startedAt:
              $ref: '#/components/schemas/DateFormat'
            lastAlive:
              $ref: '#/components/schemas/DateFormat'
            attempts:
              type: integer
          required:
            - jobId
            - addedAt
            - attempts
    ErrorObject:
      type: object
      properties:
        name:
          type: string
        message:
          type: string
      required:
        - name
        - message
    ArtifactError:
      type: object
      properties:
        fileName:
          type: string
        lockFile:
          type: string
        stderr:
          type: string
    ArtifactErrors:
      type: object
      additionalProperties:
        type: array
        items:
          $ref: '#/components/schemas/ArtifactError'
    TerminationSummary:
      type: string
      enum:
        - success
        - cli-error
        - unknown-error
        - timeout
        - worker-failure
        - error-fetching-new-job
        - access-token-error
        - purged
    JobSummary:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/TerminationSummary'
        err:
          $ref: '#/components/schemas/ErrorObject'
      required:
        - status
    JobSummaryExtended:
      allOf:
        - $ref: '#/components/schemas/JobSummary'
        - type: object
          properties:
            artifactErrors:
              $ref: '#/components/schemas/ArtifactErrors'
    FinishedJob:
      allOf:
        - $ref: '#/components/schemas/Job'
        - $ref: '#/components/schemas/JobSummaryExtended'
        - type: object
          properties:
            finishedAt:
              $ref: '#/components/schemas/DateFormat'
          required:
            - finishedAt
    JobsMeta:
      type: object
      properties:
        history:
          type: object
          properties:
            processed:
              type: integer
            lastEnqueueDate:
              $ref: '#/components/schemas/DateFormat'
            lastDispatchDate:
              $ref: '#/components/schemas/DateFormat'
            lastFinished:
              $ref: '#/components/schemas/FinishedJob'
          required:
            - processed
            - lastEnqueueDate
            - lastDispatchDate
        queue:
          type: object
          properties:
            size:
              type: integer
            inProgress:
              type: array
              items:
                $ref: '#/components/schemas/Job'
          required:
            - size
            - inProgress
      required:
        - history
        - queue
    App:
      type: object
      properties:
        repositoryCount:
          type: integer
        organizationCount:
          type: integer
      required:
        - repositoryCount
        - organizationCount
    Status:
      type: object
      properties:
        bootTime:
          $ref: '#/components/schemas/DateFormat'
        platform:
          type: string
          description: Optional platform identifier
        endpoint:
          type: string
        app:
          $ref: '#/components/schemas/App'
        scheduler:
          $ref: '#/components/schemas/Scheduler'
        webhooks:
          type: object
          properties:
            lastValidWebhookReceived:
              $ref: '#/components/schemas/DateFormat'
          required:
            - lastValidWebhookReceived
        jobs:
          $ref: '#/components/schemas/JobsMeta'
        renovateVersion:
          type: string
        license:
          type: object
          additionalProperties: true
      required:
        - bootTime
        - endpoint
        - app
        - scheduler
        - webhooks
        - jobs
        - renovateVersion
        - license
    TaskMeta:
      type: object
      properties:
        id:
          description: 'Task identifier (string for PostgreSQL, integer for SQLite, depending on the backing data handler)'
          oneOf:
            - type: integer
            - type: string
        action:
          type: string
        priority:
          type: integer
        reason:
          type: string
      required:
        - id
        - action
        - priority
        - reason
    TaskExternal:
      allOf:
        - $ref: '#/components/schemas/TaskMeta'
        - $ref: '#/components/schemas/Organization'
        - type: object
          properties:
            type:
              const: external
            repositories:
              type: array
              items:
                type: string
          required:
            - type
            - repositories
    TaskInternal:
      allOf:
        - $ref: '#/components/schemas/TaskMeta'
        - $ref: '#/components/schemas/OrganizationOptional'
        - type: object
          properties:
            type:
              const: internal
            repositories:
              type: array
              items:
                type: string
          required:
            - type
    Task:
      allOf:
        - oneOf:
            - $ref: '#/components/schemas/TaskExternal'
            - $ref: '#/components/schemas/TaskInternal'
        - type: object
          properties:
            addedAt:
              $ref: '#/components/schemas/DateFormat'
            attempts:
              type: integer
          required:
            - addedAt
            - attempts
    JobQueue:
      type: object
      properties:
        running:
          type: array
          items:
            $ref: '#/components/schemas/Job'
        pending:
          type: array
          items:
            $ref: '#/components/schemas/Job'
      required:
        - running
        - pending
    LogsNotFound:
      allOf:
        - $ref: '#/components/schemas/MessageResponse'
        - type: object
          properties:
            jobId:
              $ref: '#/components/schemas/JobId'
            logLocation:
              type: string
          required:
            - jobId
    JobReport:
      type: object
      properties:
        jobId:
          $ref: '#/components/schemas/JobId'
        reason:
          type: string
        addedAt:
          $ref: '#/components/schemas/DateFormat'
        startedAt:
          $ref: '#/components/schemas/DateFormat'
        completedAt:
          $ref: '#/components/schemas/DateFormat'
        logLocation:
          type: string
        status:
          type: string
        artifactErrors:
          $ref: '#/components/schemas/ArtifactErrors'
        error:
          $ref: '#/components/schemas/ErrorObject'
      required:
        - reason
    LibYears:
      type: object
      required:
        - total
        - managers
      properties:
        total:
          type: number
          minimum: 0
        managers:
          type: object
          additionalProperties:
            type: number
            minimum: 0
    DependencyStatus:
      type: object
      required:
        - outdated
        - total
      properties:
        outdated:
          type: integer
          minimum: 0
        total:
          type: integer
          minimum: 0
    LibYearsWithStatus:
      type: object
      required:
        - libYears
        - dependencyStatus
      properties:
        libYears:
          $ref: '#/components/schemas/LibYears'
        dependencyStatus:
          $ref: '#/components/schemas/DependencyStatus'
    LibYearsType:
      type: string
      enum:
        - repo
        - org
        - system
    LibYearsWithContext:
      allOf:
        - $ref: '#/components/schemas/LibYearsWithStatus'
        - type: object
          required:
            - id
            - type
            - name
            - updatedAt
          properties:
            id:
              type: string
            type:
              $ref: '#/components/schemas/LibYearsType'
            suspended:
              type: boolean
              description: |
                Whether access has been suspended on the installation on the organization/repository.

                When `env MEND_RNV_PLATFORM=github`: Whether the Renovate GitHub app has been suspended on the organization/repository.

                When `env MEND_RNV_PLATFORM=gitlab`: This is unused, and always returns `false`.

                When `env MEND_RNV_PLATFORM=bitbucket-server`: This is unused, and always returns `false`.
            installed:
              description: |
                Whether Renovate is installed on the organization/repository.

                When `env MEND_RNV_PLATFORM=github`: Whether the Renovate GitHub app is installed on the organization/repository.

                When `env MEND_RNV_PLATFORM=gitlab`: Whether the Renovate bot account has access to the organization/repository.

                When `env MEND_RNV_PLATFORM=bitbucket-server`: Whether the Renovate bot account has access to the organization/repository.
              type: boolean
            name:
              type: string
            updatedAt:
              $ref: '#/components/schemas/DateFormat'
            details:
              type: array
              items:
                $ref: '#/components/schemas/LibYearsWithContext'
    OrgMeta:
      type: object
      required:
        - id
        - name
        - enabled
        - suspended
      properties:
        id:
          type: string
        name:
          type: string
        enabled:
          type: boolean
        suspended:
          type: boolean
          description: |
            When `env MEND_RNV_PLATFORM=github`: Whether the Renovate GitHub app has been suspended on the organization/repository.

            When `env MEND_RNV_PLATFORM=gitlab`: This is unused, and always returns `false`.

            When `env MEND_RNV_PLATFORM=bitbucket-server`: This is unused, and always returns `false`.
        installedAt:
          $ref: '#/components/schemas/DateFormat'
        installationId:
          type: integer
        removedAt:
          $ref: '#/components/schemas/DateFormat'
    RepositoryInfo:
      type: object
      required:
        - name
        - enabled
        - fullName
      properties:
        name:
          type: string
        enabled:
          type: boolean
        fullName:
          type: string
        installedAt:
          $ref: '#/components/schemas/DateFormat'
        removedAt:
          $ref: '#/components/schemas/DateFormat'
    PostRunPullRequestSummary:
      type: object
      required:
        - merged
        - open
        - closed
        - total
      properties:
        merged:
          type: integer
        open:
          type: integer
        closed:
          type: integer
        total:
          type: integer
    PostRunRepositoryInfo:
      type: object
      required:
        - status
        - result
        - isStale
      properties:
        status:
          type: string
        result:
          type: string
        isStale:
          type: boolean
        prStats:
          $ref: '#/components/schemas/PostRunPullRequestSummary'
    OrgInstallationStatusCounts:
      type: object
      required:
        - installed
        - uninstalled
        - total
      properties:
        installed:
          type: integer
        uninstalled:
          type: integer
        total:
          type: integer
    RepositoryStatus:
      type: string
      enum:
        - activated
        - disabled
        - onboarded
        - onboarding
        - unknown
        - failed
        - resource-limit
        - timeout
    RepositoryState:
      type: string
      enum:
        - org-suspended
        - installed
        - removed
    RepositoryStatuses:
      type: object
      properties:
        activated:
          type: integer
        disabled:
          type: integer
        onboarded:
          type: integer
        onboarding:
          type: integer
        unknown:
          type: integer
        failed:
          type: integer
        resource-limit:
          type: integer
        timeout:
          type: integer
    RenovateRepositoryStatuses:
      allOf:
        - $ref: '#/components/schemas/RepositoryStatuses'
        - type: object
          properties:
            total:
              type: integer
    PullRequestSummary:
      type: object
      required:
        - merged
        - open
        - ignored
        - total
      properties:
        merged:
          type: integer
        open:
          type: integer
        ignored:
          type: integer
        total:
          type: integer
    OrgReport:
      allOf:
        - $ref: '#/components/schemas/OrgMeta'
        - type: object
          properties:
            repositories:
              $ref: '#/components/schemas/OrgInstallationStatusCounts'
            renovateStatuses:
              $ref: '#/components/schemas/RenovateRepositoryStatuses'
              x-enterprise-only: true
            pullRequests:
              $ref: '#/components/schemas/PullRequestSummary'
              x-enterprise-only: true
    PullRequestState:
      type: string
      enum:
        - merged
        - closed
        - open
    PullRequestStats:
      type: object
      required:
        - repoId
        - prNumber
        - prTitle
        - branchName
        - createdInDb
        - updatedInDb
        - state
        - link
      properties:
        repoId:
          type: string
        prNumber:
          type: integer
        prTitle:
          type: string
        branchName:
          type: string
        prCreatedAt:
          $ref: '#/components/schemas/DateFormat'
        createdInDb:
          $ref: '#/components/schemas/DateFormat'
        updatedInDb:
          $ref: '#/components/schemas/DateFormat'
        state:
          $ref: '#/components/schemas/PullRequestState'
        link:
          type: string
    RepositoryStats:
      type: object
      required:
        - id
        - name
        - fullName
        - state
      properties:
        id:
          type: string
        name:
          type: string
        fullName:
          type: string
        installedAt:
          $ref: '#/components/schemas/DateFormat'
        removedAt:
          $ref: '#/components/schemas/DateFormat'
        state:
          $ref: '#/components/schemas/RepositoryState'
        status:
          $ref: '#/components/schemas/RepositoryStatus'
          x-enterprise-only: true
        pullRequestStats:
          $ref: '#/components/schemas/PullRequestSummary'
          x-enterprise-only: true
    Notes:
      type: object
      description: Notices about the current repository.
      properties:
        repoProblems:
          x-no-backwards-compatibility-guarantees: true
          description: |
            Any "repository problems" that may have occurred during the Renovate CLI run.

            Corresponds to a debug log line such as:

            ```
            DEBUG: repository problems
            {
              "repoProblems": [
                " WARN: Package lookup failures"
              ]
            }
            ```
          type: array
          items:
            type: string
        warningMessages:
          x-no-backwards-compatibility-guarantees: true
          description: |
            Any warning log lines (`WARN`) that may have occurred during the Renovate CLI run.

            Corresponds to the `warnings` from a warning log line such as:

            ```
            WARN: Package lookup failures
            {
              "warnings": [
                "Could not determine new digest for update (github-tags package jessehouwing/actions-dependency-submission)",
                "Could not determine new digest for update (github-tags package actions/dependency-review-action)"
              ],
              "files": [
                ".github/workflows/actions-dependency-submission.yml"
              ]
            }
            ```
          type: array
          items:
            type: string
        warningAffectedFiles:
          x-no-backwards-compatibility-guarantees: true
          description: |
            Any file(s) that are marked as affected by any warning log lines (`WARN`) during the Renovate CLI run.

            Corresponds to the `files` from a warning log line such as:

            ```
            WARN: Package lookup failures
            {
              "warnings": [
                "Could not determine new digest for update (github-tags package jessehouwing/actions-dependency-submission)",
                "Could not determine new digest for update (github-tags package actions/dependency-review-action)"
              ],
              "files": [
                ".github/workflows/actions-dependency-submission.yml"
              ]
            }
            ```
          type: array
          items:
            type: string
    AnyObject:
      x-no-backwards-compatibility-guarantees: true
      description: |
        An object of unspecified format.

        This is used in cases where we are directly returning the state from the Mend Renovate CLI, and so documenting the types is less straightforward, and may change over time.

        Note that any types with this format have no backwards compatibility guarantee.
    BranchUpdates:
      type: object
      properties:
        pendingApproval:
          type: array
          items:
            $ref: '#/components/schemas/AnyObject'
        awaitingSchedule:
          type: array
          items:
            $ref: '#/components/schemas/AnyObject'
        errored:
          type: array
          items:
            $ref: '#/components/schemas/AnyObject'
        prCreationApprovalRequired:
          type: array
          items:
            $ref: '#/components/schemas/AnyObject'
        editedOrBlocked:
          type: array
          items:
            $ref: '#/components/schemas/AnyObject'
        pendingStatusChecks:
          type: array
          items:
            $ref: '#/components/schemas/AnyObject'
        ignoredOrBlocked:
          type: array
          items:
            $ref: '#/components/schemas/AnyObject'
        rateLimited:
          type: array
          items:
            $ref: '#/components/schemas/AnyObject'
        pendingBranchAutomerge:
          type: array
          items:
            $ref: '#/components/schemas/AnyObject'
        otherBranches:
          type: array
          items:
            $ref: '#/components/schemas/AnyObject'
        open:
          type: array
          items:
            $ref: '#/components/schemas/AnyObject'
    PackageFileArray:
      type: array
      items:
        $ref: '#/components/schemas/AnyObject'
    ManagerPackageFiles:
      type: object
      additionalProperties:
        $ref: '#/components/schemas/PackageFileArray'
    Deps:
      type: object
      additionalProperties:
        $ref: '#/components/schemas/ManagerPackageFiles'
    RenovateDashboard:
      type: object
      properties:
        notes:
          $ref: '#/components/schemas/Notes'
        deps:
          $ref: '#/components/schemas/Deps'
        updates:
          $ref: '#/components/schemas/BranchUpdates'
    PostRunResults:
      type: object
      properties:
        repoInfo:
          $ref: '#/components/schemas/PostRunRepositoryInfo'
        repoCache:
          $ref: '#/components/schemas/AnyObject'
        repoPrs:
          $ref: '#/components/schemas/AnyObject'
        repoLibYearsWithStatus:
          $ref: '#/components/schemas/LibYearsWithStatus'
      required:
        - repoInfo
        - repoCache
    CompleteJob:
      type: object
      properties:
        job:
          $ref: '#/components/schemas/Job'
        summary:
          $ref: '#/components/schemas/JobSummaryExtended'
        data:
          $ref: '#/components/schemas/PostRunResults'
        logPath:
          type: string
      required:
        - job
        - summary
    S3BucketKey:
      type: object
      required:
        - Bucket
        - Key
      # note: Properties use PascalCase on purpose because this is what the AWS SDK expects.
      properties:
        Bucket:
          type: string
        Key:
          type: string
    Settings:
      type: object
      properties:
        reportingEnabled:
          type: boolean
        s3LogPath:
          $ref: '#/components/schemas/S3BucketKey'
        env:
          type: object
          additionalProperties:
            type: string
    NextJob:
      type: object
      required:
        - config
        - settings
        - job
      properties:
        config: {}
        settings:
          $ref: '#/components/schemas/Settings'
        job:
          $ref: '#/components/schemas/Job'
    DateFormat:
      type: string
      format: date-time
      description: |
        **Note**: this format will be corrected in the next breaking change.

        The date formats returned at this point in time are non-standard, and depend on the database used.

        - **SQLite**: a date such as `2025-12-09 16:02:25` will be returned. A Go time format string for this would be `2006-01-02 15:04:05`
        - **PostgreSQL**: a date such as `2025-09-21 13:19:12.027202` will be returned. A Go time format string for this would be `2006-01-02 15:04:05.999999999`
      pattern: '[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}(?:\.[0-9]{6})'
    JobId:
      type: string
      format: uuid
